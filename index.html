<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>YOLO Nano Mobile Detection</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    margin: 0;
    font-family: sans-serif;
    background: #000;
    color: #fff;
    text-align: center;
  }
  #container {
    position: relative;
    width: 100vw;
    height: 70vh;
    overflow: hidden;
  }
  video, canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
</style>
</head>
<body>

<h2>YOLO Nano Real-Time Object Detection (Mobile)</h2>

<div id="container">
  <video id="video" autoplay playsinline muted></video>
  <canvas id="canvas"></canvas>
</div>

<p id="status">Loading YOLO modelâ€¦</p>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.21.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>

<!-- YOLOv8 Nano (JavaScript version compiled by Ultralytics) -->
<script src="https://cdn.jsdelivr.net/npm/@mlc-ai/web-llm/yolo.min.js"></script>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const statusEl = document.getElementById("status");

let model;
let isRunning = false;
let labels = [];

// ðŸŽ¯ Load YOLO model (tiny / nano optimized for mobile)
async function loadYOLO() {
  statusEl.textContent = "Loading YOLO Nano modelâ€¦";

  model = await YOLO.load("yolov8n"); // tiny YOLO nano
  labels = model.labels;

  statusEl.textContent = "YOLO loaded. Starting cameraâ€¦";
  startCamera();
}

// ðŸŽ¥ Start camera
async function startCamera() {
  const stream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: "environment" },
    audio: false
  });

  video.srcObject = stream;

  video.onloadedmetadata = () => {
    video.play();
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    isRunning = true;
    detectLoop();
  };
}

// ðŸ” Real-time detection loop
async function detectLoop() {
  if (!isRunning) return;

  const t0 = performance.now();

  const result = await model.detect(video);

  drawBoxes(result);

  const t1 = performance.now();
  statusEl.textContent = `FPS: ${(1000 / (t1 - t0)).toFixed(1)}`;

  requestAnimationFrame(detectLoop);
}

// ðŸŸ¦ Draw YOLO bounding boxes
function drawBoxes(detections) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const colors = ["#FF5252", "#4CAF50", "#29B6F6", "#FFEB3B", "#E040FB"];

  detections.forEach((det, index) => {
    const [x, y, w, h] = det.box;
    const label = labels[det.class_id] || "Object";
    const confidence = (det.score * 100).toFixed(1) + "%";

    const color = colors[index % colors.length];
    ctx.strokeStyle = color;
    ctx.lineWidth = 3;
    ctx.strokeRect(x, y, w, h);

    // caption
    ctx.fillStyle = color;
    ctx.font = "16px sans-serif";
    const caption = `${label} ${confidence}`;
    const textWidth = ctx.measureText(caption).width;

    ctx.fillRect(x, y - 22, textWidth + 10, 22);
    ctx.fillStyle = "#000";
    ctx.fillText(caption, x + 5, y - 5);
  });
}

// ðŸŽ¬ Start system
loadYOLO();
</script>
</body>
</html>
